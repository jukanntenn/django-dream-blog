var C=Object.defineProperty;var B=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var l=(n,t,e)=>B(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();const M="backdrop";class N{constructor(t){l(this,"elem",null);l(this,"isAppended",!1);l(this,"config");this.config=t}static get NAME(){return M}show(){this.append()}hide(){this.dispose()}dispose(){this.isAppended&&(this.elem.removeEventListener("click",this.handleClick,!0),this.elem.remove(),this.isAppended=!1)}append(){if(this.isAppended)return;const t=this.getElement();document.body.append(t),t.addEventListener("click",this.handleClick.bind(this),!0),this.isAppended=!0}getElement(){if(!this.elem){const t=document.createElement("div");this.config.className&&(t.className=this.config.className),this.elem=t}return this.elem}handleClick(){this.config.clickCallback&&this.config.clickCallback()}}const O="offcanvas",A={backdrop:!0};class I{constructor(t,e){l(this,"elem");l(this,"config");l(this,"backdrop");l(this,"oriTransformVal");l(this,"oriTranslateVal");l(this,"isShown",!1);this.elem=t,this.config=Object.assign(e||{},A),this.oriTransformVal=this.elem.style.transform,this.oriTranslateVal=this.elem.style.translate,this.backdrop=this.initializeBackDrop()}static get NAME(){return O}toggle(){return this.isShown?this.hide():this.show()}show(){var t;this.elem.style.transform="none",this.elem.style.translate="0 0",this.isShown=!0,(t=this.backdrop)==null||t.show()}hide(){var t;this.isShown&&(this.elem.style.transform=this.oriTransformVal,this.elem.style.translate=this.oriTranslateVal,this.isShown=!1,(t=this.backdrop)==null||t.hide())}initializeBackDrop(){if(!this.config.backdrop)return;const t=()=>{this.hide()};return new N({className:this.config.backdropClassName,clickCallback:t})}}const q="scrollspy";class p{constructor(t,e=document.body,s={}){l(this,"targets",[]);l(this,"scrollElement");l(this,"activeTarget",null);l(this,"config",{});this.scrollElement=e.tagName==="BODY"?window:e,this.scrollElement.addEventListener("scroll",()=>{this.process()}),Object.assign(this.config,s),this.refresh(t),this.process()}static get NAME(){return q}refresh(t){this.targets=[];const e=this.scrollElement===window?0:this.getScrollTop(),s=[];let o;const i=r=>{const a=p.getSelector(r),h=a?p.find(a,this.scrollElement===window?document.body:this.scrollElement):null;if(!h)return null;const c=h.getBoundingClientRect();return c.width||c.height?{parent:s[s.length-1],element:r,offset:this.scrollElement===window?c.top+window.pageYOffset+e:h.offsetTop+e}:null},d=r=>{if(r.length===0||Array.isArray(t[0]))throw new Error("Invalid tree structure");const a=i(r[0]);a!==null&&this.targets.push(a),o=a;for(let h=1;h<r.length;h+=1){const c=r[h];if(Array.isArray(c))s.push(o),d(c);else{const f=i(c);f!==null&&this.targets.push(f),o=f}}s.pop()};d(t),this.targets=this.targets.sort((r,a)=>r.offset-a.offset)}getScrollTop(){return this.scrollElement===window?this.scrollElement.pageYOffset:this.scrollElement.scrollTop}getScrollHeight(){return this.scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}getOffsetHeight(){return this.scrollElement===window?window.innerHeight:this.scrollElement.getBoundingClientRect().height}getSpyOffset(){return typeof this.config.offset=="function"?this.config.offset():typeof this.config.offset=="number"?this.config.offset:0}process(){const t=this.getScrollTop(),e=t+this.getSpyOffset()+1,s=this.getScrollHeight(),o=Math.max(0,s-this.getOffsetHeight());if(t+1>=o){const i=this.targets[this.targets.length-1];this.activeTarget!==i&&this.activate(i);return}if(this.activeTarget&&e<this.targets[0].offset&&this.targets[0].offset>0){this.activeTarget=null,this.clear();return}for(let i=0;i<this.targets.length;i+=1)this.activeTarget!==this.targets[i]&&e>=this.targets[i].offset&&(typeof this.targets[i+1]>"u"||e<this.targets[i+1].offset)&&this.activate(this.targets[i])}activate(t){if(this.activeTarget=t,this.clear(),this.config.activeClassName){const e=this.config.activeClassName.split(" ");this.activeTarget.element.classList.add(...e);let{parent:s}=t;for(;s;)s.element.classList.add(...e),s=s.parent}}clear(){if(this.config.activeClassName){const t=this.config.activeClassName.split(" ");this.targets.forEach(e=>e.element.classList.remove(...t))}}static getSelector(t){let e=null,s=t.getAttribute("href");return!s||!s.includes("#")&&!s.startsWith(".")?null:(s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),e=s&&s!=="#"?s.trim():null,e)}static find(t,e=document.body){if(t.startsWith("#")){const s=t.slice(1);return document.getElementById(s)}return Element.prototype.querySelector.call(e,t)}}class H{constructor(t){l(this,"_element");this._element=t,this._init()}_init(){var t;window.addEventListener("scroll",this.toggle.bind(this)),(t=this._element)==null||t.addEventListener("click",this.to.bind(this))}to(){document.documentElement.scrollTop>0&&document.documentElement.scrollTo({top:0,behavior:"smooth"})}toggle(){var e,s,o,i;const t=window.innerHeight/3;document.documentElement.scrollTop>t?((e=this._element)==null||e.classList.remove("opacity-0"),(s=this._element)==null||s.classList.add("opacity-100")):((o=this._element)==null||o.classList.remove("opacity-100"),(i=this._element)==null||i.classList.add("opacity-0"))}}const S="theme";class D{constructor(t){l(this,"currentMode","system");l(this,"button");l(this,"icons");l(this,"systemPreference");this.button=t,this.systemPreference=window.matchMedia("(prefers-color-scheme: dark)"),this.icons={light:t.querySelector('[data-theme-icon="light"]'),dark:t.querySelector('[data-theme-icon="dark"]'),system:t.querySelector('[data-theme-icon="system"]')},this.currentMode=this.getStoredTheme(),this._init()}static get NAME(){return"themeSwitcher"}_init(){this.applyTheme(this.currentMode),this.button.addEventListener("click",()=>this.toggle()),this.systemPreference.addEventListener("change",()=>{this.currentMode==="system"&&this.applyTheme("system")})}getStoredTheme(){const t=localStorage.getItem(S);return t==="light"||t==="dark"||t==="system"?t:"system"}applyTheme(t){this.currentMode=t,localStorage.setItem(S,t),this.updateIcon(),this.updateDocumentTheme()}updateDocumentTheme(){const t=document.documentElement,e=this.systemPreference.matches,s=this.currentMode==="system"?e?"dark":"light":this.currentMode,o=s==="dark"?"light":"dark";t.classList.add("theme-switching"),t.classList.add(s),t.classList.remove(o),requestAnimationFrame(()=>{t.classList.remove("theme-switching")})}updateIcon(){Object.values(this.icons).forEach(e=>{e&&e.classList.add("hidden")});let t=null;this.currentMode==="light"?t=this.icons.light:this.currentMode==="dark"?t=this.icons.dark:t=this.icons.system,t&&t.classList.remove("hidden")}toggle(){const t=["light","dark","system"],s=(t.indexOf(this.currentMode)+1)%t.length;this.applyTheme(t[s])}}function _(){document.querySelectorAll(".arithmatex").forEach(t=>{const e=t.textContent||t.innerText||"";e.startsWith("\\(")&&e.endsWith("\\)")?typeof katex<"u"&&katex.render(e.slice(2,-2),t,{displayMode:!1}):e.startsWith("\\[")&&e.endsWith("\\]")&&typeof katex<"u"&&katex.render(e.slice(2,-2),t,{displayMode:!0})})}function R(n){document.addEventListener?document.addEventListener("DOMContentLoaded",n):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&n()})}function P(){R(function(){typeof katex<"u"&&_()})}P();const L=document.getElementById("theme-switcher");L&&new D(L);new H(document.getElementById("backtop"));const F=new I(document.getElementById("left"),{backdropClassName:"backdrop"}),W=document.getElementById("offcanvas-trigger");W.addEventListener("click",function(){F.toggle()});function x(n,t){return[].filter.call(n.children,e=>e.nodeName==="LI").forEach(e=>{const s=e.querySelector(":scope > a");t.push(s);const o=e.querySelector(":scope > ul");if(o){const i=[];t.push(i),x(o,i)}})}const E=document.getElementById("toc"),T=E&&E.children[0];function w(){const n=document.getElementById("site-nav");return(n?n.getBoundingClientRect().height:0)+12}function y(n,t){if(!n)return!1;const e=decodeURIComponent(n.startsWith("#")?n.slice(1):n);if(!e)return!1;const s=document.getElementById(e);if(!s)return!1;if(!!!s.closest("#comment-list")){const m=s.getBoundingClientRect().top+window.pageYOffset-w();return window.scrollTo({top:Math.max(0,m),behavior:t}),!0}const i=w()-12,d=window.innerHeight,r=s.getBoundingClientRect(),a=r.top-i,h=r.bottom;if(a>=0&&h<=d)return!0;const c=window.pageYOffset,f=a<0?r.top+c-i:r.bottom+c-d;return window.scrollTo({top:Math.max(0,f),behavior:t}),!0}if(T){const n=[];x(T,n),new p(n,document.body,{activeClassName:"active",offset:w}),E.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a");if(!e)return;const s=e.getAttribute("href");if(!s)return;const o=s.includes("#")?s.split("#").pop():s.startsWith("#")?s.slice(1):null;if(!o)return;const i=`#${o}`;y(i,"smooth")&&(t.preventDefault(),window.location.hash!==i&&window.history.pushState(null,"",i))})}var j=function(t){document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&t()})};j(function(){window.location.hash&&y(window.location.hash,"auto")});function V(n){const t=n.querySelector("input[name='content_type']").value,e=n.querySelector("input[name='object_pk']").value;return{content_type:t,object_pk:e}}function Y(n){return fetch(n,{method:"GET"}).then(t=>(t.status,t.text())).then(t=>t).catch(t=>{})}function $(n){for(;n.nextElementSibling&&n.nextElementSibling.classList.contains("pl-12");)n=n.nextElementSibling;return n.nextElementSibling}const u=document.getElementById("comment-list"),g=document.querySelector(".comment-form");g&&g.addEventListener("submit",function(n){n.preventDefault();const t=g.querySelector("button[type='submit']");t.disabled=!0,t.textContent="正在提交...";var e=new FormData(this);fetch(this.action,{method:"POST",body:e}).then(s=>s.text()).then(s=>{if(u){u.firstChild?u.insertAdjacentHTML("afterbegin",s):u.innerHTML=s;const o=u.firstElementChild;o&&o.id&&y(`#${o.id}`,"smooth")}g.querySelector("textarea[name='comment']").value=""}).catch(s=>{console.error("提交出错:",s)}).finally(()=>{t.disabled=!1,t.textContent="提交评论"})});u&&u.addEventListener("click",n=>{const t=n.target.closest&&n.target.closest(".reply");if(t){if(n.preventDefault(),!g){const i=document.getElementById("comment-area");i&&i.scrollIntoView({behavior:"smooth",block:"start"});return}t.classList.add("hidden"),t.nextElementSibling.classList.remove("hidden");const s=V(g),o=new URLSearchParams(s);Y("/comments/form/?"+o.toString()).then(i=>{if(t.nextElementSibling.classList.add("hidden"),!i){t.classList.remove("hidden");return}t.nextElementSibling.nextElementSibling.classList.remove("hidden");const r=new DOMParser().parseFromString(i,"text/html").body.firstElementChild;r.querySelector("input[name='parent']").value=t.dataset.cid,r.querySelector('button[type="submit"]').addEventListener("click",function(a){a.preventDefault(),this.disabled=!0,this.textContent="正在提交...";const h=new FormData(r);fetch(r.action,{method:"POST",body:h}).then(c=>c.text()).then(c=>{const m=new DOMParser().parseFromString(c,"text/html").body.firstElementChild;let v=t.parentNode.parentNode.parentNode,b=$(v);b?v.parentNode.insertBefore(m,b):v.parentNode.appendChild(m),r.querySelector("textarea[name='comment']").value="",m&&m.id&&y(`#${m.id}`,"smooth")}).catch(c=>{console.error("提交出错:",c)}).finally(()=>{const c=r.querySelector("button[type='submit']");c.disabled=!1,c.textContent="提交评论"})}),t.parentNode.insertAdjacentElement("afterend",r)});return}const e=n.target.closest&&n.target.closest(".fold");e&&(e.parentNode.nextElementSibling.remove(),e.classList.add("hidden"),e.previousElementSibling.previousElementSibling.classList.remove("hidden"))});const U=10,k="backdrop-blur-md";function z(){const n=document.querySelector("[data-blur-nav]");if(!n)return;const t=()=>{window.scrollY>U?n.classList.add(k):n.classList.remove(k)};t(),window.addEventListener("scroll",t,{passive:!0})}z();
