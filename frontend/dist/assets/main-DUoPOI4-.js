var N=Object.defineProperty;var M=(o,t,e)=>t in o?N(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var r=(o,t,e)=>M(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const A="backdrop";class I{constructor(t){r(this,"elem",null);r(this,"isAppended",!1);r(this,"config");this.config=t}static get NAME(){return A}show(){this.append()}hide(){this.dispose()}dispose(){this.isAppended&&(this.elem.removeEventListener("click",this.handleClick,!0),this.elem.remove(),this.isAppended=!1)}append(){if(this.isAppended)return;const t=this.getElement();document.body.append(t),t.addEventListener("click",this.handleClick.bind(this),!0),this.isAppended=!0}getElement(){if(!this.elem){const t=document.createElement("div");this.config.className&&(t.className=this.config.className),this.elem=t}return this.elem}handleClick(){this.config.clickCallback&&this.config.clickCallback()}}const O="offcanvas",B={backdrop:!0};class R{constructor(t,e){r(this,"elem");r(this,"config");r(this,"backdrop");r(this,"oriTransformVal");r(this,"oriTranslateVal");r(this,"isShown",!1);this.elem=t,this.config=Object.assign(e||{},B),this.oriTransformVal=this.elem.style.transform,this.oriTranslateVal=this.elem.style.translate,this.backdrop=this.initializeBackDrop()}static get NAME(){return O}toggle(){return this.isShown?this.hide():this.show()}show(){var t;this.elem.style.transform="none",this.elem.style.translate="0 0",this.isShown=!0,(t=this.backdrop)==null||t.show()}hide(){var t;this.isShown&&(this.elem.style.transform=this.oriTransformVal,this.elem.style.translate=this.oriTranslateVal,this.isShown=!1,(t=this.backdrop)==null||t.hide())}initializeBackDrop(){if(!this.config.backdrop)return;const t=()=>{this.hide()};return new I({className:this.config.backdropClassName,clickCallback:t})}}const H="scrollspy";class E{constructor(t,e=document.body,s={}){r(this,"targets",[]);r(this,"scrollElement");r(this,"activeTarget",null);r(this,"config",{});this.scrollElement=e.tagName==="BODY"?window:e,this.scrollElement.addEventListener("scroll",()=>{this.process()}),Object.assign(this.config,s),this.refresh(t),this.process()}static get NAME(){return H}refresh(t){this.targets=[];const e=this.scrollElement===window?0:this.getScrollTop(),s=[];let n;const i=c=>{const a=E.getSelector(c),h=a?E.find(a,this.scrollElement===window?document.body:this.scrollElement):null;if(!h)return null;const d=h.getBoundingClientRect();return d.width||d.height?{parent:s[s.length-1],element:c,offset:this.scrollElement===window?d.top+window.pageYOffset+e:h.offsetTop+e}:null},l=c=>{if(c.length===0||Array.isArray(t[0]))throw new Error("Invalid tree structure");const a=i(c[0]);a!==null&&this.targets.push(a),n=a;for(let h=1;h<c.length;h+=1){const d=c[h];if(Array.isArray(d))s.push(n),l(d);else{const m=i(d);m!==null&&this.targets.push(m),n=m}}s.pop()};l(t),this.targets=this.targets.sort((c,a)=>c.offset-a.offset)}getScrollTop(){return this.scrollElement===window?this.scrollElement.pageYOffset:this.scrollElement.scrollTop}getScrollHeight(){return this.scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}getOffsetHeight(){return this.scrollElement===window?window.innerHeight:this.scrollElement.getBoundingClientRect().height}getSpyOffset(){return typeof this.config.offset=="function"?this.config.offset():typeof this.config.offset=="number"?this.config.offset:0}process(){const t=this.getScrollTop(),e=t+this.getSpyOffset()+1,s=this.getScrollHeight(),n=Math.max(0,s-this.getOffsetHeight());if(t+1>=n){const i=this.targets[this.targets.length-1];this.activeTarget!==i&&this.activate(i);return}if(this.activeTarget&&e<this.targets[0].offset&&this.targets[0].offset>0){this.activeTarget=null,this.clear();return}for(let i=0;i<this.targets.length;i+=1)this.activeTarget!==this.targets[i]&&e>=this.targets[i].offset&&(typeof this.targets[i+1]>"u"||e<this.targets[i+1].offset)&&this.activate(this.targets[i])}activate(t){if(this.activeTarget=t,this.clear(),this.config.activeClassName){const e=this.config.activeClassName.split(" ");this.activeTarget.element.classList.add(...e);let{parent:s}=t;for(;s;)s.element.classList.add(...e),s=s.parent}}clear(){if(this.config.activeClassName){const t=this.config.activeClassName.split(" ");this.targets.forEach(e=>e.element.classList.remove(...t))}}static getSelector(t){let e=null,s=t.getAttribute("href");return!s||!s.includes("#")&&!s.startsWith(".")?null:(s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),e=s&&s!=="#"?s.trim():null,e)}static find(t,e=document.body){if(t.startsWith("#")){const s=t.slice(1);return document.getElementById(s)}return Element.prototype.querySelector.call(e,t)}}class q{constructor(t){r(this,"_element");this._element=t,this._init()}_init(){var t;window.addEventListener("scroll",this.toggle.bind(this)),(t=this._element)==null||t.addEventListener("click",this.to.bind(this))}to(){document.documentElement.scrollTop>0&&document.documentElement.scrollTo({top:0,behavior:"smooth"})}toggle(){var e,s,n,i;const t=window.innerHeight/3;document.documentElement.scrollTop>t?((e=this._element)==null||e.classList.remove("opacity-0"),(s=this._element)==null||s.classList.add("opacity-100")):((n=this._element)==null||n.classList.remove("opacity-100"),(i=this._element)==null||i.classList.add("opacity-0"))}}const b="theme";class D{constructor(t){r(this,"currentMode","system");r(this,"button");r(this,"icons");r(this,"systemPreference");this.button=t,this.systemPreference=window.matchMedia("(prefers-color-scheme: dark)"),this.icons={light:t.querySelector('[data-theme-icon="light"]'),dark:t.querySelector('[data-theme-icon="dark"]'),system:t.querySelector('[data-theme-icon="system"]')},this.currentMode=this.getStoredTheme(),this._init()}static get NAME(){return"themeSwitcher"}_init(){this.applyTheme(this.currentMode),this.button.addEventListener("click",()=>this.toggle()),this.systemPreference.addEventListener("change",()=>{this.currentMode==="system"&&this.applyTheme("system")})}getStoredTheme(){const t=localStorage.getItem(b);return t==="light"||t==="dark"||t==="system"?t:"system"}applyTheme(t){this.currentMode=t,localStorage.setItem(b,t),this.updateIcon(),this.updateDocumentTheme()}updateDocumentTheme(){const t=document.documentElement,e=this.systemPreference.matches,s=this.currentMode==="system"?e?"dark":"light":this.currentMode,n=s==="dark"?"light":"dark";t.classList.add("theme-switching"),t.classList.add(s),t.classList.remove(n),requestAnimationFrame(()=>{t.classList.remove("theme-switching")})}updateIcon(){Object.values(this.icons).forEach(e=>{e&&e.classList.add("hidden")});let t=null;this.currentMode==="light"?t=this.icons.light:this.currentMode==="dark"?t=this.icons.dark:t=this.icons.system,t&&t.classList.remove("hidden")}toggle(){const t=["light","dark","system"],s=(t.indexOf(this.currentMode)+1)%t.length;this.applyTheme(t[s])}}const F="toast",_={type:"info",duration:3e3};class w{constructor(t,e){r(this,"elem",null);r(this,"config");r(this,"timer",null);this.config={..._,...e},this.show(t)}static get NAME(){return F}show(t){this.elem=this.createElement(t),document.body.appendChild(this.elem),this.timer=window.setTimeout(()=>{this.hide()},this.config.duration)}hide(){this.elem&&(this.elem.classList.add("toast--fade-out"),setTimeout(()=>{this.dispose()},200))}dispose(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.elem&&this.elem.parentNode&&(this.elem.parentNode.removeChild(this.elem),this.elem=null)}createElement(t){const e=document.createElement("div");return e.className=`toast toast--${this.config.type}`,e.textContent=t,e}}const $="comment",P={formSelector:".comment-form",listSelector:"#comment-list",areaSelector:"#comment-area"},u={network:"Network connection failed, please try again",server:"Server error, please try again later"};class W{constructor(t={}){r(this,"formElem");r(this,"listElem");r(this,"areaElem");r(this,"config");this.config={...P,...t},this.formElem=document.querySelector(this.config.formSelector),this.listElem=document.querySelector(this.config.listSelector),this.areaElem=document.querySelector(this.config.areaSelector)}static get NAME(){return $}init(){this.formElem&&this.formElem.addEventListener("submit",this.handleSubmit.bind(this)),this.listElem&&this.listElem.addEventListener("click",this.handleListClick.bind(this))}scrollToSelector(t,e="smooth"){return this.scrollToHash(t,e)}focusForm(){var e;const t=(e=this.formElem)==null?void 0:e.querySelector("textarea");t&&setTimeout(()=>t.focus(),100)}handleSubmit(t){t.preventDefault();const e=t.target,s=e.querySelector("button[type='submit']");if(!s)return;this.setButtonLoading(s,!0);const n=new FormData(e);fetch(e.action,{method:"POST",body:n}).then(i=>{if(!i.ok)throw new Error(u.server);return i.text()}).then(i=>{this.insertComment(i),this.resetForm(e),new w("Comment posted successfully",{type:"success"})}).catch(i=>{this.showError(i.message||u.network)}).finally(()=>{this.setButtonLoading(s,!1)})}handleListClick(t){const e=t.target,s=e.closest(".reply");if(s){t.preventDefault(),this.handleReply(s);return}const n=e.closest(".fold");n&&(t.preventDefault(),this.handleFold(n))}handleReply(t){var i;if(!this.formElem){(i=this.areaElem)==null||i.scrollIntoView({behavior:"smooth",block:"start"});return}t.classList.add("hidden");const e=t.nextElementSibling;e==null||e.classList.remove("hidden");const s=this.getTargetFields(this.formElem),n=new URLSearchParams(s);this.fetchForm(`/comments/form/?${n.toString()}`).then(l=>{var m;if(e==null||e.classList.add("hidden"),!l){t.classList.remove("hidden");return}const c=e==null?void 0:e.nextElementSibling;c==null||c.classList.remove("hidden");const a=this.parseHtml(l),h=a.querySelector("input[name='parent']");h&&(h.value=t.dataset.cid||""),this.setupReplyForm(a,t),(m=t.parentNode)==null||m.insertAdjacentElement("afterend",a);const d=a.querySelector("textarea");d&&setTimeout(()=>d.focus(),100)}).catch(()=>{e==null||e.classList.add("hidden"),t.classList.remove("hidden"),this.showError(u.network)})}handleFold(t){var n,i;const e=(n=t.parentNode)==null?void 0:n.nextElementSibling;e==null||e.remove(),t.classList.add("hidden");const s=(i=t.previousElementSibling)==null?void 0:i.previousElementSibling;s==null||s.classList.remove("hidden")}setupReplyForm(t,e){const s=t.querySelector("button[type='submit']");s&&s.addEventListener("click",n=>{n.preventDefault(),this.submitReply(t,e,s)})}submitReply(t,e,s){this.setButtonLoading(s,!0);const n=new FormData(t);fetch(t.action,{method:"POST",body:n}).then(i=>{if(!i.ok)throw new Error(u.server);return i.text()}).then(i=>{var d,m,f,p,S;const l=this.parseHtml(i),c=(m=(d=e.parentNode)==null?void 0:d.parentNode)==null?void 0:m.parentNode,a=this.getInsertBeforeElement(c);a?(f=c.parentNode)==null||f.insertBefore(l,a):(p=c.parentNode)==null||p.appendChild(l),t.remove(),e.classList.remove("hidden");const h=(S=e.nextElementSibling)==null?void 0:S.nextElementSibling;h==null||h.classList.add("hidden"),l.id&&this.scrollToHash(`#${l.id}`),new w("Reply posted successfully",{type:"success"})}).catch(i=>{this.showError(i.message||u.network)}).finally(()=>{this.setButtonLoading(s,!1)})}insertComment(t){if(!this.listElem)return;this.listElem.firstChild?this.listElem.insertAdjacentHTML("afterbegin",t):this.listElem.innerHTML=t;const e=this.listElem.firstElementChild;e!=null&&e.id&&this.scrollToHash(`#${e.id}`)}resetForm(t){const e=t.querySelector("textarea[name='comment']");e&&(e.value="")}setButtonLoading(t,e){t.disabled=e,e?(t.dataset.originalText=t.textContent||"",t.textContent="Submitting..."):t.textContent=t.dataset.originalText||"Submit"}getTargetFields(t){var n,i;const e=((n=t.querySelector("input[name='content_type']"))==null?void 0:n.value)||"",s=((i=t.querySelector("input[name='object_pk']"))==null?void 0:i.value)||"";return{content_type:e,object_pk:s}}fetchForm(t){return fetch(t,{method:"GET"}).then(e=>{if(!e.ok)throw new Error(u.server);return e.text()})}parseHtml(t){return new DOMParser().parseFromString(t,"text/html").body.firstElementChild}getInsertBeforeElement(t){var s,n;let e=t;for(;(s=e.nextElementSibling)!=null&&s.classList.contains("pl-12")||(n=e.nextElementSibling)!=null&&n.classList.contains("md:pl-14");)e=e.nextElementSibling;return e.nextElementSibling}scrollToHash(t,e="smooth"){const s=t.startsWith("#")?t.slice(1):t,n=document.getElementById(s);if(!n)return!1;const i=document.getElementById("site-nav"),c=(i?i.getBoundingClientRect().height:0)+12,a=window.innerHeight,h=n.getBoundingClientRect(),d=h.top-c,m=h.bottom;if(d>=0&&m<=a)return!0;const f=window.pageYOffset,p=d<0?h.top+f-c:h.bottom+f-a;return window.scrollTo({top:Math.max(0,p),behavior:e}),!0}showError(t){new w(t,{type:"error"})}}function j(){document.querySelectorAll(".arithmatex").forEach(t=>{const e=t.textContent||t.innerText||"";e.startsWith("\\(")&&e.endsWith("\\)")?typeof katex<"u"&&katex.render(e.slice(2,-2),t,{displayMode:!1}):e.startsWith("\\[")&&e.endsWith("\\]")&&typeof katex<"u"&&katex.render(e.slice(2,-2),t,{displayMode:!0})})}function U(o){document.addEventListener?document.addEventListener("DOMContentLoaded",o):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&o()})}function V(){U(function(){typeof katex<"u"&&j()})}V();const L=document.getElementById("theme-switcher");L&&new D(L);new q(document.getElementById("backtop"));const Y=new R(document.getElementById("left"),{backdropClassName:"backdrop"}),G=document.getElementById("offcanvas-trigger");G.addEventListener("click",function(){Y.toggle()});function C(o,t){return[].filter.call(o.children,e=>e.nodeName==="LI").forEach(e=>{const s=e.querySelector(":scope > a");t.push(s);const n=e.querySelector(":scope > ul");if(n){const i=[];t.push(i),C(n,i)}})}const v=document.getElementById("toc"),T=v&&v.children[0];function x(){const o=document.getElementById("site-nav");return(o?o.getBoundingClientRect().height:0)+12}function y(o,t){const e=o.getBoundingClientRect().top+window.pageYOffset-x();window.scrollTo({top:Math.max(0,e),behavior:t})}const g=new W;g.init();if(T){const o=[];C(T,o),new E(o,document.body,{activeClassName:"active",offset:x}),v.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a");if(!e)return;const s=e.getAttribute("href");if(!s)return;const n=s.includes("#")?s.split("#").pop():s.startsWith("#")?s.slice(1):null;if(!n)return;let i=n;try{i=decodeURIComponent(n)}catch{}const l=document.getElementById(i);if(!l)return;if(l.closest("#comment-list")){if(!g.scrollToSelector(`#${i}`,"smooth"))return}else y(l,"smooth");t.preventDefault();const c=`#${i}`;window.location.hash!==c&&window.history.pushState(null,"",c)})}var z=function(t){document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&t()})};z(function(){if(window.location.hash){let o=window.location.hash.slice(1);try{o=decodeURIComponent(o)}catch{}const t=document.getElementById(o);if(!t)return;t.closest("#comment-list")?g.scrollToSelector(`#${o}`,"auto"):o==="comment-area"?(y(t,"auto"),g.focusForm()):y(t,"auto")}});document.addEventListener("click",o=>{const t=o.target.closest&&o.target.closest('a[href$="#comment-area"]');if(!t)return;const e=t.getAttribute("href");if(!e||!(new URL(e,window.location.origin).pathname===window.location.pathname))return;o.preventDefault();const i=document.getElementById("comment-area");i&&(y(i,"smooth"),g.focusForm(),window.location.hash!=="#comment-area"&&window.history.pushState(null,"","#comment-area"))});const K=10,k="backdrop-blur-md";function J(){const o=document.querySelector("[data-blur-nav]");if(!o)return;const t=()=>{window.scrollY>K?o.classList.add(k):o.classList.remove(k)};t(),window.addEventListener("scroll",t,{passive:!0})}J();
