var N=Object.defineProperty;var A=(o,e,t)=>e in o?N(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>A(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const _="backdrop";class I{constructor(e){r(this,"elem",null);r(this,"isAppended",!1);r(this,"config");this.config=e}static get NAME(){return _}show(){this.append()}hide(){this.dispose()}dispose(){this.isAppended&&(this.elem.removeEventListener("click",this.handleClick,!0),this.elem.remove(),this.isAppended=!1)}append(){if(this.isAppended)return;const e=this.getElement();document.body.append(e),e.addEventListener("click",this.handleClick.bind(this),!0),this.isAppended=!0}getElement(){if(!this.elem){const e=document.createElement("div");this.config.className&&(e.className=this.config.className),this.elem=e}return this.elem}handleClick(){this.config.clickCallback&&this.config.clickCallback()}}const O="offcanvas",B={backdrop:!0};class R{constructor(e,t){r(this,"elem");r(this,"config");r(this,"backdrop");r(this,"oriTransformVal");r(this,"oriTranslateVal");r(this,"isShown",!1);this.elem=e,this.config=Object.assign(t||{},B),this.oriTransformVal=this.elem.style.transform,this.oriTranslateVal=this.elem.style.translate,this.backdrop=this.initializeBackDrop()}static get NAME(){return O}toggle(){return this.isShown?this.hide():this.show()}show(){var e;this.elem.style.transform="none",this.elem.style.translate="0 0",this.isShown=!0,(e=this.backdrop)==null||e.show()}hide(){var e;this.isShown&&(this.elem.style.transform=this.oriTransformVal,this.elem.style.translate=this.oriTranslateVal,this.isShown=!1,(e=this.backdrop)==null||e.hide())}initializeBackDrop(){if(!this.config.backdrop)return;const e=()=>{this.hide()};return new I({className:this.config.backdropClassName,clickCallback:e})}}const H="scrollspy";class w{constructor(e,t=document.body,s={}){r(this,"targets",[]);r(this,"scrollElement");r(this,"activeTarget",null);r(this,"config",{});this.scrollElement=t.tagName==="BODY"?window:t,this.scrollElement.addEventListener("scroll",()=>{this.process()}),Object.assign(this.config,s),this.refresh(e),this.process()}static get NAME(){return H}refresh(e){this.targets=[];const t=this.scrollElement===window?0:this.getScrollTop(),s=[];let n;const i=c=>{const l=w.getSelector(c),d=l?w.find(l,this.scrollElement===window?document.body:this.scrollElement):null;if(!d)return null;const h=d.getBoundingClientRect();return h.width||h.height?{parent:s[s.length-1],element:c,offset:this.scrollElement===window?h.top+window.pageYOffset+t:d.offsetTop+t}:null},a=c=>{if(c.length===0||Array.isArray(e[0]))throw new Error("Invalid tree structure");const l=i(c[0]);l!==null&&this.targets.push(l),n=l;for(let d=1;d<c.length;d+=1){const h=c[d];if(Array.isArray(h))s.push(n),a(h);else{const m=i(h);m!==null&&this.targets.push(m),n=m}}s.pop()};a(e),this.targets=this.targets.sort((c,l)=>c.offset-l.offset)}getScrollTop(){return this.scrollElement===window?this.scrollElement.pageYOffset:this.scrollElement.scrollTop}getScrollHeight(){return this.scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}getOffsetHeight(){return this.scrollElement===window?window.innerHeight:this.scrollElement.getBoundingClientRect().height}getSpyOffset(){return typeof this.config.offset=="function"?this.config.offset():typeof this.config.offset=="number"?this.config.offset:0}process(){const e=this.getScrollTop(),t=e+this.getSpyOffset()+1,s=this.getScrollHeight(),n=Math.max(0,s-this.getOffsetHeight());if(e+1>=n){const i=this.targets[this.targets.length-1];this.activeTarget!==i&&this.activate(i);return}if(this.activeTarget&&t<this.targets[0].offset&&this.targets[0].offset>0){this.activeTarget=null,this.clear();return}for(let i=0;i<this.targets.length;i+=1)this.activeTarget!==this.targets[i]&&t>=this.targets[i].offset&&(typeof this.targets[i+1]>"u"||t<this.targets[i+1].offset)&&this.activate(this.targets[i])}activate(e){if(this.activeTarget=e,this.clear(),this.config.activeClassName){const t=this.config.activeClassName.split(" ");this.activeTarget.element.classList.add(...t);let{parent:s}=e;for(;s;)s.element.classList.add(...t),s=s.parent}}clear(){if(this.config.activeClassName){const e=this.config.activeClassName.split(" ");this.targets.forEach(t=>t.element.classList.remove(...e))}}static getSelector(e){let t=null,s=e.getAttribute("href");return!s||!s.includes("#")&&!s.startsWith(".")?null:(s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),t=s&&s!=="#"?s.trim():null,t)}static find(e,t=document.body){if(e.startsWith("#")){const s=e.slice(1);return document.getElementById(s)}return Element.prototype.querySelector.call(t,e)}}class P{constructor(e){r(this,"_element");this._element=e,this._init()}_init(){var e;window.addEventListener("scroll",this.toggle.bind(this)),(e=this._element)==null||e.addEventListener("click",this.to.bind(this))}to(){document.documentElement.scrollTop>0&&document.documentElement.scrollTo({top:0,behavior:"smooth"})}toggle(){var t,s,n,i;const e=window.innerHeight/3;document.documentElement.scrollTop>e?((t=this._element)==null||t.classList.remove("opacity-0"),(s=this._element)==null||s.classList.add("opacity-100")):((n=this._element)==null||n.classList.remove("opacity-100"),(i=this._element)==null||i.classList.add("opacity-0"))}}const L="theme";class q{constructor(e){r(this,"currentMode","system");r(this,"button");r(this,"icons");r(this,"systemPreference");this.button=e,this.systemPreference=window.matchMedia("(prefers-color-scheme: dark)"),this.icons={light:e.querySelector('[data-theme-icon="light"]'),dark:e.querySelector('[data-theme-icon="dark"]'),system:e.querySelector('[data-theme-icon="system"]')},this.currentMode=this.getStoredTheme(),this._init()}static get NAME(){return"themeSwitcher"}_init(){this.applyTheme(this.currentMode),this.button.addEventListener("click",()=>this.toggle()),this.systemPreference.addEventListener("change",()=>{this.currentMode==="system"&&this.applyTheme("system")})}getStoredTheme(){const e=localStorage.getItem(L);return e==="light"||e==="dark"||e==="system"?e:"system"}applyTheme(e){this.currentMode=e,localStorage.setItem(L,e),this.updateIcon(),this.updateDocumentTheme()}updateDocumentTheme(){const e=document.documentElement,t=this.systemPreference.matches,s=this.currentMode==="system"?t?"dark":"light":this.currentMode,n=s==="dark"?"light":"dark";e.classList.add("theme-switching"),e.classList.add(s),e.classList.remove(n),requestAnimationFrame(()=>{e.classList.remove("theme-switching")})}updateIcon(){Object.values(this.icons).forEach(t=>{t&&t.classList.add("hidden")});let e=null;this.currentMode==="light"?e=this.icons.light:this.currentMode==="dark"?e=this.icons.dark:e=this.icons.system,e&&e.classList.remove("hidden")}toggle(){const e=["light","dark","system"],s=(e.indexOf(this.currentMode)+1)%e.length;this.applyTheme(e[s])}}const D="toast",F={type:"info",duration:3e3};class y{constructor(e,t){r(this,"elem",null);r(this,"config");r(this,"timer",null);this.config={...F,...t},this.show(e)}static get NAME(){return D}show(e){this.elem=this.createElement(e),document.body.appendChild(this.elem),this.timer=window.setTimeout(()=>{this.hide()},this.config.duration)}hide(){this.elem&&(this.elem.classList.add("toast--fade-out"),setTimeout(()=>{this.dispose()},200))}dispose(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.elem&&this.elem.parentNode&&(this.elem.parentNode.removeChild(this.elem),this.elem=null)}createElement(e){const t=document.createElement("div");return t.className=`toast toast--${this.config.type}`,t.textContent=e,t}}const $="comment",j={formSelector:".comment-form",listSelector:"#comment-list",areaSelector:"#comment-area"},u={network:"Network connection failed, please try again",server:"Server error, please try again later"};class W{constructor(e={}){r(this,"formElem");r(this,"listElem");r(this,"areaElem");r(this,"config");this.config={...j,...e},this.formElem=document.querySelector(this.config.formSelector),this.listElem=document.querySelector(this.config.listSelector),this.areaElem=document.querySelector(this.config.areaSelector)}static get NAME(){return $}init(){this.formElem&&this.formElem.addEventListener("submit",this.handleSubmit.bind(this)),this.listElem&&this.listElem.addEventListener("click",this.handleListClick.bind(this))}scrollToSelector(e,t="smooth"){return this.scrollToHash(e,t)}focusForm(){var t;const e=(t=this.formElem)==null?void 0:t.querySelector("textarea");e&&setTimeout(()=>e.focus(),100)}handleSubmit(e){e.preventDefault();const t=e.target,s=t.querySelector("button[type='submit']");if(!s)return;this.setButtonLoading(s,!0);const n=new FormData(t);fetch(t.action,{method:"POST",body:n}).then(i=>{if(!i.ok)throw new Error(u.server);return i.text()}).then(i=>{this.insertComment(i),this.resetForm(t),new y("Comment posted successfully",{type:"success"})}).catch(i=>{this.showError(i.message||u.network)}).finally(()=>{this.setButtonLoading(s,!1)})}handleListClick(e){const t=e.target,s=t.closest(".reply");if(s){e.preventDefault(),this.handleReply(s);return}const n=t.closest(".fold");n&&(e.preventDefault(),this.handleFold(n))}handleReply(e){var i;if(!this.formElem){(i=this.areaElem)==null||i.scrollIntoView({behavior:"smooth",block:"start"});return}e.classList.add("hidden");const t=e.nextElementSibling;t==null||t.classList.remove("hidden");const s=this.getTargetFields(this.formElem),n=new URLSearchParams(s);this.fetchForm(`/comments/form/?${n.toString()}`).then(a=>{var m;if(t==null||t.classList.add("hidden"),!a){e.classList.remove("hidden");return}const c=t==null?void 0:t.nextElementSibling;c==null||c.classList.remove("hidden");const l=this.parseHtml(a),d=l.querySelector("input[name='parent']");d&&(d.value=e.dataset.cid||""),this.setupReplyForm(l,e),(m=e.parentNode)==null||m.insertAdjacentElement("afterend",l);const h=l.querySelector("textarea");h&&setTimeout(()=>h.focus(),100)}).catch(()=>{t==null||t.classList.add("hidden"),e.classList.remove("hidden"),this.showError(u.network)})}handleFold(e){var n,i;const t=(n=e.parentNode)==null?void 0:n.nextElementSibling;t==null||t.remove(),e.classList.add("hidden");const s=(i=e.previousElementSibling)==null?void 0:i.previousElementSibling;s==null||s.classList.remove("hidden")}setupReplyForm(e,t){const s=e.querySelector("button[type='submit']");s&&s.addEventListener("click",n=>{n.preventDefault(),this.submitReply(e,t,s)})}submitReply(e,t,s){this.setButtonLoading(s,!0);const n=new FormData(e);fetch(e.action,{method:"POST",body:n}).then(i=>{if(!i.ok)throw new Error(u.server);return i.text()}).then(i=>{var h,m,f,p,S;const a=this.parseHtml(i),c=(m=(h=t.parentNode)==null?void 0:h.parentNode)==null?void 0:m.parentNode,l=this.getInsertBeforeElement(c);l?(f=c.parentNode)==null||f.insertBefore(a,l):(p=c.parentNode)==null||p.appendChild(a),e.remove(),t.classList.remove("hidden");const d=(S=t.nextElementSibling)==null?void 0:S.nextElementSibling;d==null||d.classList.add("hidden"),a.id&&this.scrollToHash(`#${a.id}`),new y("Reply posted successfully",{type:"success"})}).catch(i=>{this.showError(i.message||u.network)}).finally(()=>{this.setButtonLoading(s,!1)})}insertComment(e){if(!this.listElem)return;this.listElem.firstChild?this.listElem.insertAdjacentHTML("afterbegin",e):this.listElem.innerHTML=e;const t=this.listElem.firstElementChild;t!=null&&t.id&&this.scrollToHash(`#${t.id}`)}resetForm(e){const t=e.querySelector("textarea[name='comment']");t&&(t.value="")}setButtonLoading(e,t){e.disabled=t,t?(e.dataset.originalText=e.textContent||"",e.textContent="Submitting..."):e.textContent=e.dataset.originalText||"Submit"}getTargetFields(e){var n,i;const t=((n=e.querySelector("input[name='content_type']"))==null?void 0:n.value)||"",s=((i=e.querySelector("input[name='object_pk']"))==null?void 0:i.value)||"";return{content_type:t,object_pk:s}}fetchForm(e){return fetch(e,{method:"GET"}).then(t=>{if(!t.ok)throw new Error(u.server);return t.text()})}parseHtml(e){return new DOMParser().parseFromString(e,"text/html").body.firstElementChild}getInsertBeforeElement(e){var s,n;let t=e;for(;(s=t.nextElementSibling)!=null&&s.classList.contains("pl-12")||(n=t.nextElementSibling)!=null&&n.classList.contains("md:pl-14");)t=t.nextElementSibling;return t.nextElementSibling}scrollToHash(e,t="smooth"){const s=e.startsWith("#")?e.slice(1):e,n=document.getElementById(s);if(!n)return!1;const i=document.getElementById("site-nav"),c=(i?i.getBoundingClientRect().height:0)+12,l=window.innerHeight,d=n.getBoundingClientRect(),h=d.top-c,m=d.bottom;if(h>=0&&m<=l)return!0;const f=window.pageYOffset,p=h<0?d.top+f-c:d.bottom+f-l;return window.scrollTo({top:Math.max(0,p),behavior:t}),!0}showError(e){new y(e,{type:"error"})}}function U(){document.querySelectorAll(".arithmatex").forEach(e=>{const t=e.textContent||e.innerText||"";t.startsWith("\\(")&&t.endsWith("\\)")?typeof katex<"u"&&katex.render(t.slice(2,-2),e,{displayMode:!1}):t.startsWith("\\[")&&t.endsWith("\\]")&&typeof katex<"u"&&katex.render(t.slice(2,-2),e,{displayMode:!0})})}function V(){return typeof katex<"u"?Promise.resolve():(window.__katexLoadingPromise||(window.__katexLoadingPromise=new Promise((o,e)=>{const t=document.createElement("script");t.src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.js",t.onload=()=>o(),t.onerror=()=>e(new Error("Failed to load KaTeX")),document.head.appendChild(t)})),window.__katexLoadingPromise)}function Y(o){document.addEventListener?document.addEventListener("DOMContentLoaded",o):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&o()})}function K(){Y(function(){document.querySelector(".arithmatex")&&V().then(()=>{typeof katex<"u"&&U()}).catch(()=>{})})}K();function G(){return window.mermaid?Promise.resolve():(window.__mermaidLoadingPromise||(window.__mermaidLoadingPromise=new Promise((o,e)=>{const t=document.createElement("script");t.src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js",t.onload=()=>o(),t.onerror=()=>e(new Error("Failed to load Mermaid")),document.head.appendChild(t)})),window.__mermaidLoadingPromise)}function b(){document.querySelector(".mermaid")&&G().then(()=>{if(!window.mermaid)return;try{window.mermaid.init({startOnLoad:!1,securityLevel:"loose"})}catch{}const o=Array.from(document.querySelectorAll(".mermaid:not([data-processed])"));if(o.length)try{window.mermaid.init(void 0,o)}catch{}}).catch(()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b();const k=document.getElementById("theme-switcher");k&&new q(k);new P(document.getElementById("backtop"));const z=new R(document.getElementById("left"),{backdropClassName:"backdrop"}),X=document.getElementById("offcanvas-trigger");X.addEventListener("click",function(){z.toggle()});function C(o,e){return[].filter.call(o.children,t=>t.nodeName==="LI").forEach(t=>{const s=t.querySelector(":scope > a");e.push(s);const n=t.querySelector(":scope > ul");if(n){const i=[];e.push(i),C(n,i)}})}const v=document.getElementById("toc"),T=v&&v.children[0];function M(){const o=document.getElementById("site-nav");return(o?o.getBoundingClientRect().height:0)+12}function E(o,e){const t=o.getBoundingClientRect().top+window.pageYOffset-M();window.scrollTo({top:Math.max(0,t),behavior:e})}const g=new W;g.init();if(T){const o=[];C(T,o),new w(o,document.body,{activeClassName:"active",offset:M}),v.addEventListener("click",e=>{const t=e.target.closest&&e.target.closest("a");if(!t)return;const s=t.getAttribute("href");if(!s)return;const n=s.includes("#")?s.split("#").pop():s.startsWith("#")?s.slice(1):null;if(!n)return;let i=n;try{i=decodeURIComponent(n)}catch{}const a=document.getElementById(i);if(!a)return;if(a.closest("#comment-list")){if(!g.scrollToSelector(`#${i}`,"smooth"))return}else E(a,"smooth");e.preventDefault();const c=`#${i}`;window.location.hash!==c&&window.history.pushState(null,"",c)})}var J=function(e){document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&e()})};J(function(){if(window.location.hash){let o=window.location.hash.slice(1);try{o=decodeURIComponent(o)}catch{}const e=document.getElementById(o);if(!e)return;e.closest("#comment-list")?g.scrollToSelector(`#${o}`,"auto"):o==="comment-area"?(E(e,"auto"),g.focusForm()):E(e,"auto")}});document.addEventListener("click",o=>{const e=o.target.closest&&o.target.closest('a[href$="#comment-area"]');if(!e)return;const t=e.getAttribute("href");if(!t||!(new URL(t,window.location.origin).pathname===window.location.pathname))return;o.preventDefault();const i=document.getElementById("comment-area");i&&(E(i,"smooth"),g.focusForm(),window.location.hash!=="#comment-area"&&window.history.pushState(null,"","#comment-area"))});const Q=10,x="backdrop-blur-md";function Z(){const o=document.querySelector("[data-blur-nav]");if(!o)return;const e=()=>{window.scrollY>Q?o.classList.add(x):o.classList.remove(x)};e(),window.addEventListener("scroll",e,{passive:!0})}Z();
