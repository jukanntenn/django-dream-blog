const n={katexLoaded:!1,katexCssLoaded:!1,mermaidLoaded:!1,mermaidInitialized:!1};function s(){if(n.katexLoaded&&n.katexCssLoaded)return Promise.resolve();const t=n.katexCssLoaded?Promise.resolve():new Promise((e,o)=>{const r=document.createElement("link");r.rel="stylesheet",r.href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.css",r.onload=()=>{n.katexCssLoaded=!0,e()},r.onerror=()=>o(new Error("Failed to load KaTeX CSS")),document.head.appendChild(r)}),a=n.katexLoaded?Promise.resolve():new Promise((e,o)=>{const r=document.createElement("script");r.src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.8/katex.min.js",r.onload=()=>{n.katexLoaded=!0,e()},r.onerror=()=>o(new Error("Failed to load KaTeX JS")),document.head.appendChild(r)});return Promise.all([t,a]).then(()=>{})}function c(){return n.mermaidLoaded?Promise.resolve():new Promise((t,a)=>{const e=document.createElement("script");e.src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js",e.onload=()=>{n.mermaidLoaded=!0,t()},e.onerror=()=>a(new Error("Failed to load Mermaid")),document.head.appendChild(e)})}function l(){if(!(!n.mermaidLoaded||n.mermaidInitialized||!window.mermaid))try{window.mermaid.init({startOnLoad:!1,securityLevel:"loose"}),n.mermaidInitialized=!0}catch(t){console.error("Failed to initialize Mermaid:",t)}}function m(t){if(!n.katexLoaded||!window.katex)return;t.querySelectorAll(".arithmatex").forEach(e=>{if(e.classList.contains("katex")||e.querySelector(".katex"))return;const o=e.textContent||e.innerText||"";if(o.startsWith("\\(")&&o.endsWith("\\)"))try{window.katex.render(o.slice(2,-2),e,{throwOnError:!1,displayMode:!1})}catch(r){console.error("KaTeX render error:",r)}else if(o.startsWith("\\[")&&o.endsWith("\\]"))try{window.katex.render(o.slice(2,-2),e,{throwOnError:!1,displayMode:!0})}catch(r){console.error("KaTeX render error:",r)}})}function u(t){if(!n.mermaidLoaded)return;l();const a=t.querySelectorAll(".mermaid:not([data-processed])");if(a.length!==0)try{window.mermaid.init(void 0,Array.from(a))}catch(e){console.error("Mermaid render error:",e)}}function h(t){try{m(t),u(t)}catch(a){console.error("Preview rendering error:",a)}}function f(t,a){let e=null;return function(...o){e!==null&&clearTimeout(e),e=setTimeout(()=>t.apply(this,o),a)}}function d(){const t=document.querySelectorAll("[data-md-preview]");if(t.length===0){console.debug("No preview elements found with [data-md-preview]");return}const a=f(async e=>{const o=e.querySelector(".arithmatex")!==null,r=e.querySelector(".mermaid")!==null;if(!(!o&&!r))try{o&&await s(),r&&await c(),h(e)}catch(i){console.error("Failed to render preview content:",i)}},100);t.forEach(e=>{new MutationObserver(r=>{r.forEach(i=>{if(i.type==="childList"||i.type==="characterData"){a(e);return}})}).observe(e,{childList:!0,subtree:!0,characterData:!0}),a(e)})}function w(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d(),setTimeout(d,500)}w();
