var S=Object.defineProperty;var w=(i,e,t)=>e in i?S(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(w(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const L="backdrop";class k{constructor(e){l(this,"elem",null);l(this,"isAppended",!1);l(this,"config");this.config=e}static get NAME(){return L}show(){this.append()}hide(){this.dispose()}dispose(){this.isAppended&&(this.elem.removeEventListener("click",this.handleClick,!0),this.elem.remove(),this.isAppended=!1)}append(){if(this.isAppended)return;const e=this.getElement();document.body.append(e),e.addEventListener("click",this.handleClick.bind(this),!0),this.isAppended=!0}getElement(){if(!this.elem){const e=document.createElement("div");this.config.className&&(e.className=this.config.className),this.elem=e}return this.elem}handleClick(){this.config.clickCallback&&this.config.clickCallback()}}const x="offcanvas",T={backdrop:!0};class C{constructor(e,t){l(this,"elem");l(this,"config");l(this,"backdrop");l(this,"oriTransformVal");l(this,"isShown",!1);this.elem=e,this.config=Object.assign(t||{},T),this.oriTransformVal=this.elem.style.transform,this.backdrop=this.initializeBackDrop()}static get NAME(){return x}toggle(){return this.isShown?this.hide():this.show()}show(){var e;this.elem.style.transform="none",this.isShown=!0,(e=this.backdrop)==null||e.show()}hide(){var e;this.isShown&&(this.elem.style.transform=this.oriTransformVal,this.isShown=!1,(e=this.backdrop)==null||e.hide())}initializeBackDrop(){if(!this.config.backdrop)return;const e=()=>{this.hide()};return new k({className:this.config.backdropClassName,clickCallback:e})}}const N="scrollspy";class u{constructor(e,t=document.body,n={}){l(this,"targets",[]);l(this,"scrollElement");l(this,"activeTarget",null);l(this,"config",{});this.scrollElement=t.tagName==="BODY"?window:t,this.scrollElement.addEventListener("scroll",()=>{this.process()}),Object.assign(this.config,n),this.refresh(e),this.process()}static get NAME(){return N}refresh(e){const t=this.scrollElement===window?0:this.getScrollTop(),n=[];let s;const r=d=>{const o=u.getSelector(d),h=o?u.find(o,this.scrollElement===window?document.body:this.scrollElement):null;if(!h)return null;const m=h.getBoundingClientRect();return m.width||m.height?{parent:n[n.length-1],element:d,offset:this.scrollElement===window?m.top+window.pageYOffset+t:h.offsetTop+t}:null},c=d=>{if(d.length===0||Array.isArray(e[0]))throw new Error("Invalid tree structure");const o=r(d[0]);o!==null&&this.targets.push(o),s=o;for(let h=1;h<d.length;h+=1){const m=d[h];if(Array.isArray(m))n.push(s),c(m);else{const a=r(m);a!==null&&this.targets.push(a),s=a}}n.pop()};c(e),this.targets=this.targets.sort((d,o)=>d.offset-o.offset)}getScrollTop(){return this.scrollElement===window?this.scrollElement.pageYOffset:this.scrollElement.scrollTop}getScrollHeight(){return this.scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}getOffsetHeight(){return this.scrollElement===window?window.innerHeight:this.scrollElement.getBoundingClientRect().height}process(){const e=this.getScrollTop(),n=this.getScrollHeight()-this.getOffsetHeight();if(e>=n){const s=this.targets[this.targets.length-1];this.activeTarget!==s&&this.activate(s);return}if(this.activeTarget&&e<this.targets[0].offset&&this.targets[0].offset>0){this.activeTarget=null,this.clear();return}for(let s=0;s<this.targets.length;s+=1)this.activeTarget!==this.targets[s]&&e>=this.targets[s].offset&&(typeof this.targets[s+1]>"u"||e<this.targets[s+1].offset)&&this.activate(this.targets[s])}activate(e){if(this.activeTarget=e,this.clear(),this.config.activeClassName){const t=this.config.activeClassName.split(" ");this.activeTarget.element.classList.add(...t);let{parent:n}=e;for(;n;)n.element.classList.add(...t),n=n.parent}}clear(){if(this.config.activeClassName){const e=this.config.activeClassName.split(" ");this.targets.forEach(t=>t.element.classList.remove(...e))}}static getSelector(e){let t=null,n=e.getAttribute("href");return!n||!n.includes("#")&&!n.startsWith(".")?null:(n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&n!=="#"?n.trim():null,t)}static find(e,t=document.body){return Element.prototype.querySelector.call(t,e)}}class A{constructor(e){l(this,"_element");this._element=e,this._init()}_init(){var e;window.addEventListener("scroll",this.toggle.bind(this)),(e=this._element)==null||e.addEventListener("click",this.to.bind(this))}to(){document.documentElement.scrollTop>0&&document.documentElement.scrollTo({top:0,behavior:"smooth"})}toggle(){var t,n,s,r;const e=window.innerHeight/3;document.documentElement.scrollTop>e?((t=this._element)==null||t.classList.remove("opacity-0"),(n=this._element)==null||n.classList.add("opacity-100")):((s=this._element)==null||s.classList.remove("opacity-100"),(r=this._element)==null||r.classList.add("opacity-0"))}}new A(document.getElementById("backtop"));const B=new C(document.getElementById("left"),{backdropClassName:"backdrop"}),O=document.getElementById("offcanvas-trigger");O.addEventListener("click",function(){B.toggle()});function b(i,e){return[].filter.call(i.children,t=>t.nodeName==="LI").forEach(t=>{const n=t.querySelector(":scope > a");e.push(n);const s=t.querySelector(":scope > ul");if(s){const r=[];e.push(r),b(s,r)}})}const v=document.getElementById("toc"),E=v&&v.children[0];if(E){const i=[];b(E,i),new u(i,document.body,{activeClassName:"active"})}var q=function(){for(var i=document.querySelectorAll(".arithmatex"),e,t=0;t<i.length;t++)e=i[t].textContent||i[t].innerText,e.startsWith("\\(")&&e.endsWith("\\)")?katex.render(e.slice(2,-2),i[t],{displayMode:!1}):e.startsWith("\\[")&&e.endsWith("\\]")&&katex.render(e.slice(2,-2),i[t],{displayMode:!0})},M=function(e){document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&e()})};M(function(){typeof katex<"u"&&q()});function D(i){const e=i.querySelector("input[name='content_type']").value,t=i.querySelector("input[name='object_pk']").value;return{content_type:e,object_pk:t}}function H(i){return fetch(i,{method:"GET"}).then(e=>(e.status,e.text())).then(e=>e).catch(e=>{})}function _(i){for(;i.nextElementSibling&&i.nextElementSibling.classList.contains("pl-14");)i=i.nextElementSibling;return i.nextElementSibling}const f=document.querySelector(".comment-form");f&&(f.addEventListener("submit",function(t){t.preventDefault();const n=f.querySelector("button[type='submit']");n.disabled=!0,n.textContent="正在提交...";var s=new FormData(this);fetch(this.action,{method:"POST",body:s}).then(r=>r.text()).then(r=>{const c=document.getElementById("comment-list");c.firstChild?c.insertAdjacentHTML("afterbegin",r):c.innerHTML=r,f.querySelector("textarea[name='comment']").value=""}).catch(r=>{console.error("提交出错:",r)}).finally(()=>{n.disabled=!1,n.textContent="提交评论"})}),document.querySelectorAll(".reply").forEach(t=>{t.addEventListener("click",function(n){n.preventDefault(),t.classList.add("hidden"),t.nextElementSibling.classList.remove("hidden");const s=D(f),r=new URLSearchParams(s);H("/comments/form/?"+r.toString()).then(c=>{t.nextElementSibling.classList.add("hidden"),t.nextElementSibling.nextElementSibling.classList.remove("hidden");const o=new DOMParser().parseFromString(c,"text/html").body.firstChild;o.querySelector("input[name='parent']").value=this.dataset.cid,o.querySelector('button[type="submit"]').addEventListener("click",function(h){h.preventDefault(),this.disabled=!0,this.textContent="正在提交...";const m=new FormData(o);fetch(o.action,{method:"POST",body:m}).then(a=>a.text()).then(a=>{const p=new DOMParser().parseFromString(a,"text/html").body.firstChild;let g=t.parentNode.parentNode.parentNode,y=_(g);y?g.parentNode.insertBefore(p,y):g.parentNode.appendChild(p),o.querySelector("textarea[name='comment']").value=""}).catch(a=>{console.error("提交出错:",a)}).finally(()=>{const a=o.querySelector("button[type='submit']");a.disabled=!1,a.textContent="提交评论"})}),this.parentNode.insertAdjacentElement("afterend",o)})})}),document.querySelectorAll(".fold").forEach(t=>{t.addEventListener("click",function(){t.parentNode.nextElementSibling.remove(),t.classList.add("hidden"),t.previousElementSibling.previousElementSibling.classList.remove("hidden")})}));
