var T=Object.defineProperty;var L=(i,e,t)=>e in i?T(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>L(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const x="backdrop";class C{constructor(e){o(this,"elem",null);o(this,"isAppended",!1);o(this,"config");this.config=e}static get NAME(){return x}show(){this.append()}hide(){this.dispose()}dispose(){this.isAppended&&(this.elem.removeEventListener("click",this.handleClick,!0),this.elem.remove(),this.isAppended=!1)}append(){if(this.isAppended)return;const e=this.getElement();document.body.append(e),e.addEventListener("click",this.handleClick.bind(this),!0),this.isAppended=!0}getElement(){if(!this.elem){const e=document.createElement("div");this.config.className&&(e.className=this.config.className),this.elem=e}return this.elem}handleClick(){this.config.clickCallback&&this.config.clickCallback()}}const N="offcanvas",A={backdrop:!0};class M{constructor(e,t){o(this,"elem");o(this,"config");o(this,"backdrop");o(this,"oriTransformVal");o(this,"oriTranslateVal");o(this,"isShown",!1);this.elem=e,this.config=Object.assign(t||{},A),this.oriTransformVal=this.elem.style.transform,this.oriTranslateVal=this.elem.style.translate,this.backdrop=this.initializeBackDrop()}static get NAME(){return N}toggle(){return this.isShown?this.hide():this.show()}show(){var e;this.elem.style.transform="none",this.elem.style.translate="0 0",this.isShown=!0,(e=this.backdrop)==null||e.show()}hide(){var e;this.isShown&&(this.elem.style.transform=this.oriTransformVal,this.elem.style.translate=this.oriTranslateVal,this.isShown=!1,(e=this.backdrop)==null||e.hide())}initializeBackDrop(){if(!this.config.backdrop)return;const e=()=>{this.hide()};return new C({className:this.config.backdropClassName,clickCallback:e})}}const B="scrollspy";class f{constructor(e,t=document.body,s={}){o(this,"targets",[]);o(this,"scrollElement");o(this,"activeTarget",null);o(this,"config",{});this.scrollElement=t.tagName==="BODY"?window:t,this.scrollElement.addEventListener("scroll",()=>{this.process()}),Object.assign(this.config,s),this.refresh(e),this.process()}static get NAME(){return B}refresh(e){const t=this.scrollElement===window?0:this.getScrollTop(),s=[];let n;const r=d=>{const c=f.getSelector(d),h=c?f.find(c,this.scrollElement===window?document.body:this.scrollElement):null;if(!h)return null;const m=h.getBoundingClientRect();return m.width||m.height?{parent:s[s.length-1],element:d,offset:this.scrollElement===window?m.top+window.pageYOffset+t:h.offsetTop+t}:null},l=d=>{if(d.length===0||Array.isArray(e[0]))throw new Error("Invalid tree structure");const c=r(d[0]);c!==null&&this.targets.push(c),n=c;for(let h=1;h<d.length;h+=1){const m=d[h];if(Array.isArray(m))s.push(n),l(m);else{const a=r(m);a!==null&&this.targets.push(a),n=a}}s.pop()};l(e),this.targets=this.targets.sort((d,c)=>d.offset-c.offset)}getScrollTop(){return this.scrollElement===window?this.scrollElement.pageYOffset:this.scrollElement.scrollTop}getScrollHeight(){return this.scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}getOffsetHeight(){return this.scrollElement===window?window.innerHeight:this.scrollElement.getBoundingClientRect().height}process(){const e=this.getScrollTop(),s=this.getScrollHeight()-this.getOffsetHeight();if(e>=s){const n=this.targets[this.targets.length-1];this.activeTarget!==n&&this.activate(n);return}if(this.activeTarget&&e<this.targets[0].offset&&this.targets[0].offset>0){this.activeTarget=null,this.clear();return}for(let n=0;n<this.targets.length;n+=1)this.activeTarget!==this.targets[n]&&e>=this.targets[n].offset&&(typeof this.targets[n+1]>"u"||e<this.targets[n+1].offset)&&this.activate(this.targets[n])}activate(e){if(this.activeTarget=e,this.clear(),this.config.activeClassName){const t=this.config.activeClassName.split(" ");this.activeTarget.element.classList.add(...t);let{parent:s}=e;for(;s;)s.element.classList.add(...t),s=s.parent}}clear(){if(this.config.activeClassName){const e=this.config.activeClassName.split(" ");this.targets.forEach(t=>t.element.classList.remove(...e))}}static getSelector(e){let t=null,s=e.getAttribute("href");return!s||!s.includes("#")&&!s.startsWith(".")?null:(s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),t=s&&s!=="#"?s.trim():null,t)}static find(e,t=document.body){return Element.prototype.querySelector.call(t,e)}}class O{constructor(e){o(this,"_element");this._element=e,this._init()}_init(){var e;window.addEventListener("scroll",this.toggle.bind(this)),(e=this._element)==null||e.addEventListener("click",this.to.bind(this))}to(){document.documentElement.scrollTop>0&&document.documentElement.scrollTo({top:0,behavior:"smooth"})}toggle(){var t,s,n,r;const e=window.innerHeight/3;document.documentElement.scrollTop>e?((t=this._element)==null||t.classList.remove("opacity-0"),(s=this._element)==null||s.classList.add("opacity-100")):((n=this._element)==null||n.classList.remove("opacity-100"),(r=this._element)==null||r.classList.add("opacity-0"))}}const v="theme";class q{constructor(e){o(this,"currentMode","system");o(this,"button");o(this,"icons");o(this,"systemPreference");this.button=e,this.systemPreference=window.matchMedia("(prefers-color-scheme: dark)"),this.icons={light:e.querySelector('[data-theme-icon="light"]'),dark:e.querySelector('[data-theme-icon="dark"]'),system:e.querySelector('[data-theme-icon="system"]')},this.currentMode=this.getStoredTheme(),this._init()}static get NAME(){return"themeSwitcher"}_init(){this.applyTheme(this.currentMode),this.button.addEventListener("click",()=>this.toggle()),this.systemPreference.addEventListener("change",()=>{this.currentMode==="system"&&this.applyTheme("system")})}getStoredTheme(){const e=localStorage.getItem(v);return e==="light"||e==="dark"||e==="system"?e:"system"}applyTheme(e){this.currentMode=e,localStorage.setItem(v,e),this.updateIcon(),this.updateDocumentTheme()}updateDocumentTheme(){const e=document.documentElement,t=this.systemPreference.matches,s=this.currentMode==="system"?t?"dark":"light":this.currentMode,n=s==="dark"?"light":"dark";e.classList.add("theme-switching"),e.classList.add(s),e.classList.remove(n),requestAnimationFrame(()=>{e.classList.remove("theme-switching")})}updateIcon(){Object.values(this.icons).forEach(t=>{t&&t.classList.add("hidden")});let e=null;this.currentMode==="light"?e=this.icons.light:this.currentMode==="dark"?e=this.icons.dark:e=this.icons.system,e&&e.classList.remove("hidden")}toggle(){const e=["light","dark","system"],s=(e.indexOf(this.currentMode)+1)%e.length;this.applyTheme(e[s])}}const w=document.getElementById("theme-switcher");w&&new q(w);new O(document.getElementById("backtop"));const I=new M(document.getElementById("left"),{backdropClassName:"backdrop"}),D=document.getElementById("offcanvas-trigger");D.addEventListener("click",function(){I.toggle()});function b(i,e){return[].filter.call(i.children,t=>t.nodeName==="LI").forEach(t=>{const s=t.querySelector(":scope > a");e.push(s);const n=t.querySelector(":scope > ul");if(n){const r=[];e.push(r),b(n,r)}})}const p=document.getElementById("toc"),S=p&&p.children[0];function H(){const i=document.getElementById("site-nav");return(i?i.getBoundingClientRect().height:0)+12}function k(i,e){if(!i)return!1;const t=decodeURIComponent(i.startsWith("#")?i.slice(1):i);if(!t)return!1;const s=document.getElementById(t);if(!s)return!1;const n=s.getBoundingClientRect().top+window.pageYOffset-H();return window.scrollTo({top:Math.max(0,n),behavior:e}),!0}if(S){const i=[];b(S,i),new f(i,document.body,{activeClassName:"active"}),p.addEventListener("click",e=>{const t=e.target.closest&&e.target.closest("a");if(!t)return;const s=t.getAttribute("href");if(!s)return;const n=s.includes("#")?s.split("#").pop():s.startsWith("#")?s.slice(1):null;if(!n)return;const r=`#${n}`;k(r,"smooth")&&(e.preventDefault(),window.location.hash!==r&&window.history.pushState(null,"",r))})}var _=function(){for(var i=document.querySelectorAll(".arithmatex"),e,t=0;t<i.length;t++)e=i[t].textContent||i[t].innerText,e.startsWith("\\(")&&e.endsWith("\\)")?katex.render(e.slice(2,-2),i[t],{displayMode:!1}):e.startsWith("\\[")&&e.endsWith("\\]")&&katex.render(e.slice(2,-2),i[t],{displayMode:!0})},P=function(e){document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.addEventListener("onreadystatechange",function(){document.readyState==="interactive"&&e()})};P(function(){typeof katex<"u"&&_(),window.location.hash&&k(window.location.hash,"auto")});function F(i){const e=i.querySelector("input[name='content_type']").value,t=i.querySelector("input[name='object_pk']").value;return{content_type:e,object_pk:t}}function R(i){return fetch(i,{method:"GET"}).then(e=>(e.status,e.text())).then(e=>e).catch(e=>{})}function W(i){for(;i.nextElementSibling&&i.nextElementSibling.classList.contains("pl-14");)i=i.nextElementSibling;return i.nextElementSibling}const u=document.querySelector(".comment-form");u&&(u.addEventListener("submit",function(t){t.preventDefault();const s=u.querySelector("button[type='submit']");s.disabled=!0,s.textContent="正在提交...";var n=new FormData(this);fetch(this.action,{method:"POST",body:n}).then(r=>r.text()).then(r=>{const l=document.getElementById("comment-list");l.firstChild?l.insertAdjacentHTML("afterbegin",r):l.innerHTML=r,u.querySelector("textarea[name='comment']").value=""}).catch(r=>{console.error("提交出错:",r)}).finally(()=>{s.disabled=!1,s.textContent="提交评论"})}),document.querySelectorAll(".reply").forEach(t=>{t.addEventListener("click",function(s){s.preventDefault(),t.classList.add("hidden"),t.nextElementSibling.classList.remove("hidden");const n=F(u),r=new URLSearchParams(n);R("/comments/form/?"+r.toString()).then(l=>{t.nextElementSibling.classList.add("hidden"),t.nextElementSibling.nextElementSibling.classList.remove("hidden");const c=new DOMParser().parseFromString(l,"text/html").body.firstChild;c.querySelector("input[name='parent']").value=this.dataset.cid,c.querySelector('button[type="submit"]').addEventListener("click",function(h){h.preventDefault(),this.disabled=!0,this.textContent="正在提交...";const m=new FormData(c);fetch(c.action,{method:"POST",body:m}).then(a=>a.text()).then(a=>{const y=new DOMParser().parseFromString(a,"text/html").body.firstChild;let g=t.parentNode.parentNode.parentNode,E=W(g);E?g.parentNode.insertBefore(y,E):g.parentNode.appendChild(y),c.querySelector("textarea[name='comment']").value=""}).catch(a=>{console.error("提交出错:",a)}).finally(()=>{const a=c.querySelector("button[type='submit']");a.disabled=!1,a.textContent="提交评论"})}),this.parentNode.insertAdjacentElement("afterend",c)})})}),document.querySelectorAll(".fold").forEach(t=>{t.addEventListener("click",function(){t.parentNode.nextElementSibling.remove(),t.classList.add("hidden"),t.previousElementSibling.previousElementSibling.classList.remove("hidden")})}));
